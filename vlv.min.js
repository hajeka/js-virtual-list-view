function jsvlv(e,n,t,o){function i(e,n){H||o.onSelectRow(e,n)}function l(e,n){n.addEventListener("click",function(){i(e,n)},!1)}function r(){var e;2>Math.abs(J)?(z+=J,J=0):(e=Math.round(.6*J),z+=e,J-=e)}function u(){var e,t;if(r(),0>z)for(B.style.top=z+"px",e=P+1;n-z-j>0;){if(!(T>e)){j>n?(z=n-j,B.style.top=z+"px"):(B.style.top="0px",z=0);break}t=M[e-1].index+1,w(t),e++}else z>0&&(z=0,J=0,B.style.top="0px");Q.set(-z/(K-n)),0!=J&&requestAnimationFrame(u)}function a(e){J+=(K-n)*-e-z,requestAnimationFrame(u)}function s(e){e.preventDefault(),H||(e.stopPropagation(),v(),J+=e.wheelDeltaY,requestAnimationFrame(u))}function c(e){H||(Q.enable(),e.preventDefault())}function d(e){Q.disable(),e.preventDefault()}function f(e){var n=!1;if(!H){switch(e.keyCode){case y:h(b),n=!0;break;case F:h(R),n=!0;break;case D:case C:-1!=Y&&(o.onSelectRow(M[Y].index,M[Y].element),n=!0)}n&&(e.preventDefault(),e.stopPropagation())}}function h(e){var n,t;-1==Y?(Y=m(),o.onFocusRow(M[Y].index,M[Y].element)):(n=Y+e,n>=0&&T>n&&(e==R&&n>P&&(t=M[P].index+1,w(n)),o.onBlurRow(M[Y].index,M[Y].element),p(n),o.onFocusRow(M[n].index,M[n].element),Y=n))}function v(){-1!=Y&&(o.onBlurRow(M[Y].index,M[Y].element),Y=-1)}function m(){for(var e=-z,n=0,t=0;M.length>t&&!(n>=e);t++)n+=M[t].height;return t}function p(e){for(var t=0,o=0,i=0;M.length>i&&(o=M[i].height,i!=e);i++)t+=o;-z>t?(J+=-(z+t),requestAnimationFrame(u)):o+t>n-z&&(J-=t+o-n+z,requestAnimationFrame(u))}function w(e){var n,o=t.contentForRowAtIndex(e);B.appendChild(o),n=$(o).outerHeight(!0),j+=n,M.push({index:e,element:o,height:n}),l(e,o),P=e,G=(G*e+n)/(e+1),K=G*T}function g(){for(var e=0;n>j&&T>e;)w(e),e++;K>n&&Q.show()}function x(){for(v();B.firstChild;)B.removeChild(B.firstChild);Q.hide(),B.style.top="0px",M=[],O=0,P=-1,j=0,z=0,T=t?t.numberOfRows():0}var b=-1,R=1,y=38,F=40,D=13,C=32,k=this,E="vlv"+Math.round(1e6*Math.random()),A='<div id="<%= id %>" class="vlv-container" style="width:<%=width %>px;height:<%=height %>px;"></div>',I=$(_.template(A,{id:E,width:e,height:n})),q=I[0],L=null,S=$('<div class="vlv-content"></div>'),B=S[0],H=!1,M=[],O=0,P=-1,j=0,z=0,J=0,N=!1,T=t?t.numberOfRows():0,Y=-1,G=0,K=0,Q=null;return o=o||{},o.onSelectRow=o.onSelectRow||function(){},o.onFocusRow=o.onFocusRow||function(){},o.onBlurRow=o.onBlurRow||function(){},scrollInfoDelegate={},scrollInfoDelegate.scrollHeight=function(){return 5e3},scrollInfoDelegate.clientHeight=function(){return 300},k.getElement=function(){return q},k.show=function(e){q.appendChild(B),Q=new jsvlvscrollbar(a),q.appendChild(Q.getElement()),I.bind("mouseenter",c),I.bind("mouseleave",d),q.addEventListener("mousewheel",s,!0),document.addEventListener("keydown",f,!0),e.appendChild(q),N=!0,L=e,x(),g()},k.hide=function(){I.bind("mouseenter",c),I.bind("mouseleave",d),q.removeEventListener("mousewheel",s,!0),document.removeEventListener("keydown",f,!0),N&&(L&&L.removeChild(q),N=!1)},k.reload=function(){x(),g()},k.freeze=function(){H=!0,Q.disable()},k.unfreeze=function(){H=!1,Q.enable()},k.dbgdmp=function(){var e={scrollDistance:z,scrollDistancePending:J,contentHeight:j,firstIndex:O,lastIndex:P,indexOfFocused:Y,contentTop:B.style.top};console.log(JSON.stringify(e))},k}