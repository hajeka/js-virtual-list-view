function jsvlv(a,b,i,m){var v=-1,E=1,A=38,s=40,K=13,H=32;var V=this,d=("vlv"+Math.round(Math.random()*1000000)),R='<div id="<%= id %>" class="vlv-container" style="width:<%=width %>px;height:<%=height %>px;"></div>',O=$(_.template(R,{id:d,width:a,height:b})),W=O[0],t=null,C=$('<div class="vlv-content"></div>'),L=C[0],aa=false,e=[],x=0,j=-1,c=0,I=0,y=0,P=false,g=i?i.numberOfRows():0,u=-1,B=0,q=0,G=null;m=m||{};m.onSelectRow=m.onSelectRow||function(){};m.onFocusRow=m.onFocusRow||function(){};m.onBlurRow=m.onBlurRow||function(){};scrollInfoDelegate={};scrollInfoDelegate.scrollHeight=function(){return 5000};scrollInfoDelegate.clientHeight=function(){return 300};function r(ab,ac){if(aa){return}m.onSelectRow(ab,ac)}function f(ab,ac){ac.addEventListener("click",function(ad){r(ab,ac)},false)}function h(ab,ac){ac.removeEventListener("click",function(ad){r(ab,ac)},false)}function o(){var ab;if(Math.abs(y)<2){I+=y;y=0}else{ab=Math.round(y*0.6);I+=ab;y-=ab}}function T(){var ac,ab;o();if(I<0){L.style.top=I+"px";ac=j+1;while(b-I-c>0){if(ac<g){ab=e[ac-1].index+1;S(ab);ac++}else{if(c>b){I=b-c;L.style.top=I+"px"}else{L.style.top="0px";I=0}break}}}else{if(I>0){I=0;y=0;L.style.top="0px"}}G&&G.set(-(I)/(q-b));if(y!=0){requestAnimationFrame(T)}}function U(ab){y+=(q-b)*(-ab)-I;requestAnimationFrame(T)}function M(ac){var ab=ac.wheelDeltaY||ac.wheelDelta||-(ac.detail);ac.preventDefault();if(aa){return}ac.stopPropagation();Z();y+=ab;requestAnimationFrame(T)}function k(){if(typeof(document.onmousewheel)=="object"){document.body.addEventListener("mousewheel",M,true)}else{}}function X(){if(typeof(document.onmousewheel)=="object"){document.body.removeEventListener("mousewheel",M,true)}else{}}function l(ab){if(!aa){G&&G.enable();ab.preventDefault()}}function w(ab){G&&G.disable();ab.preventDefault()}function p(ac){var ab=false;if(aa){return}switch(ac.keyCode){case A:Y(v);ab=true;break;case s:Y(E);ab=true;break;case K:case H:if(u!=-1){m.onSelectRow(e[u].index,e[u].element);ab=true}break}if(ab){ac.preventDefault();ac.stopPropagation()}}function Y(ad){var ac,ab;if(u==-1){u=z();m.onFocusRow(e[u].index,e[u].element)}else{ac=u+ad;if(ac>=0&&ac<g){if(ad==E&&ac>j){ab=e[j].index+1;S(ac)}m.onBlurRow(e[u].index,e[u].element);N(ac);m.onFocusRow(e[ac].index,e[ac].element);u=ac}}}function Z(){if(u!=-1){m.onBlurRow(e[u].index,e[u].element);u=-1}}function z(){var ad=-I,ac=0,ab=0;for(;ab<e.length;ab++){if(ac>=ad){break}else{ac+=e[ab].height}}return ab}function N(ac){var af=0,ae=0,ad=0,ab=0;for(;ad<e.length;ad++){ae=e[ad].height;if(ad==ac){break}else{af+=ae}}if(af<-I){y+=-(I+af);requestAnimationFrame(T)}else{if(ae+af>(b-I)){y-=af+ae-b+I;requestAnimationFrame(T)}}}function S(ab){var ad=i.contentForRowAtIndex(ab),ac;L.appendChild(ad);ac=$(ad).outerHeight(true);c+=ac;e.push({index:ab,element:ad,height:ac});f(ab,ad);j=ab;B=(B*ab+ac)/(ab+1);q=B*g}function F(ab){var ad=i.contentForRowAtIndex(ab),ac;L.insertBefore(ad,L.firstChild);ac=$(ad).outerHeight(true);c+=ac;e.unshift({index:ab,element:ad,height:ac});f(ab,ad);x=ab}function J(){var ab=e.pop();h(ab.index,ab.element);L.removeChild(ab.element);c-=elementInfo.height;j--}function D(ab){var ac=e.shift();h(ac.index,ac.element);L.removeChild(ac.element);c-=elementInfo.height;x++}function n(){var ad,ac,ab=0;while(c<b&&ab<g){S(ab);ab++}if(q>b){G=new jsvlvscrollbar(U);W.appendChild(G.getElement());G.show()}}function Q(){Z();while(L.firstChild){L.removeChild(L.firstChild)}G&&G.hide();L.style.top="0px";e=[];x=0;j=-1;c=0;I=0;g=i?i.numberOfRows():0}V.getElement=function(){return W};V.show=function(ab){W.appendChild(L);O.bind("mouseenter",l);O.bind("mouseleave",w);k();document.addEventListener("keydown",p,true);ab.appendChild(W);P=true;t=ab;Q();n()};V.hide=function(){O.unbind("mouseenter",l);O.unbind("mouseleave",w);X();document.removeEventListener("keydown",p,true);if(P){t&&t.removeChild(W);P=false}};V.reload=function(){Q();n()};V.freeze=function(){aa=true;G&&G.disable()};V.unfreeze=function(){aa=false;G&&G.enable()};V.dbgdmp=function(){var ab={scrollDistance:I,scrollDistancePending:y,contentHeight:c,firstIndex:x,lastIndex:j,indexOfFocused:u,contentTop:L.style.top};console.log(JSON.stringify(ab))};return V};