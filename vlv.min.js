function jsvlv(e,n,t,o){function i(e,n){M||o.onSelectRow(e,n)}function l(e,n){n.addEventListener("click",function(){i(e,n)},!1)}function r(){var e;2>Math.abs(T)?(N+=T,T=0):(e=Math.round(.6*T),N+=e,T-=e)}function u(){var e,t;if(r(),0>N)for(H.style.top=N+"px",e=z+1;n-N-J>0;){if(!(G>e)){J>n?(N=n-J,H.style.top=N+"px"):(H.style.top="0px",N=0);break}t=O[e-1].index+1,b(t),e++}else N>0&&(N=0,T=0,H.style.top="0px");V&&V.set(-N/(U-n)),0!=T&&requestAnimationFrame(u)}function c(e){T+=(U-n)*-e-N,requestAnimationFrame(u)}function a(e){var n=e.wheelDeltaY||e.wheelDelta||-e.detail;e.preventDefault(),M||(e.stopPropagation(),p(),T+=n,requestAnimationFrame(u))}function s(){"object"==typeof document.onmousewheel&&document.body.addEventListener("mousewheel",a)}function d(){"object"==typeof document.onmousewheel&&document.body.removeEventListener("mousewheel",a)}function f(e){M||(V&&V.enable(),e.preventDefault())}function h(e){V&&V.disable(),e.preventDefault()}function m(e){var n=!1;if(!M){switch(e.keyCode){case F:v(R),n=!0;break;case C:v(D),n=!0;break;case k:case E:-1!=K&&(o.onSelectRow(O[K].index,O[K].element),n=!0)}n&&(e.preventDefault(),e.stopPropagation())}}function v(e){var n,t;-1==K?(K=w(),o.onFocusRow(O[K].index,O[K].element)):(n=K+e,n>=0&&G>n&&(e==D&&n>z&&(t=O[z].index+1,b(n)),o.onBlurRow(O[K].index,O[K].element),g(n),o.onFocusRow(O[n].index,O[n].element),K=n))}function p(){-1!=K&&(o.onBlurRow(O[K].index,O[K].element),K=-1)}function w(){for(var e=-N,n=0,t=0;O.length>t&&!(n>=e);t++)n+=O[t].height;return t}function g(e){for(var t=0,o=0,i=0;O.length>i&&(o=O[i].height,i!=e);i++)t+=o;-N>t?(T+=-(N+t),requestAnimationFrame(u)):o+t>n-N&&(T-=t+o-n+N,requestAnimationFrame(u))}function b(e){var n,o=t.contentForRowAtIndex(e);H.appendChild(o),n=$(o).outerHeight(!0),J+=n,O.push({index:e,element:o,height:n}),l(e,o),z=e,Q=(Q*e+n)/(e+1),U=Q*G}function x(){for(var e=0;n>J&&G>e;)b(e),e++;U>n&&(V=new jsvlvscrollbar(c),S.appendChild(V.getElement()),V.show())}function y(){for(p();H.firstChild;)H.removeChild(H.firstChild);V&&V.hide(),H.style.top="0px",O=[],P=0,z=-1,J=0,N=0,G=t?t.numberOfRows():0}var R=-1,D=1,F=38,C=40,k=13,E=32,A=this,I="vlv"+Math.round(1e6*Math.random()),q='<div id="<%= id %>" class="vlv-container" style="width:<%=width %>px;height:<%=height %>px;"></div>',L=$(_.template(q,{id:I,width:e,height:n})),S=L[0],j=null,B=$('<div class="vlv-content"></div>'),H=B[0],M=!1,O=[],P=0,z=-1,J=0,N=0,T=0,Y=!1,G=t?t.numberOfRows():0,K=-1,Q=0,U=0,V=null;return o=o||{},o.onSelectRow=o.onSelectRow||function(){},o.onFocusRow=o.onFocusRow||function(){},o.onBlurRow=o.onBlurRow||function(){},scrollInfoDelegate={},scrollInfoDelegate.scrollHeight=function(){return 5e3},scrollInfoDelegate.clientHeight=function(){return 300},A.getElement=function(){return S},A.show=function(e){S.appendChild(H),L.bind("mouseenter",f),L.bind("mouseleave",h),s(),document.addEventListener("keydown",m,!0),e.appendChild(S),Y=!0,j=e,y(),x()},A.hide=function(){L.unbind("mouseenter",f),L.unbind("mouseleave",h),d(),document.removeEventListener("keydown",m,!0),Y&&(j&&j.removeChild(S),Y=!1)},A.reload=function(){y(),x()},A.freeze=function(){M=!0,V&&V.disable()},A.unfreeze=function(){M=!1,V&&V.enable()},A.dbgdmp=function(){var e={scrollDistance:N,scrollDistancePending:T,contentHeight:J,firstIndex:P,lastIndex:z,indexOfFocused:K,contentTop:H.style.top};console.log(JSON.stringify(e))},A}