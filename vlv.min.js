function jsvlv(e,n,t,o){function i(e,n){H||o.onSelectRow(e,n)}function l(e,n){n.addEventListener("click",function(){i(e,n)},!1)}function r(){var e;2>Math.abs(T)?(N+=T,T=0):(e=Math.round(.6*T),N+=e,T-=e)}function u(){var e,t;if(r(),0>N)for(B.style.top=N+"px",e=Y+1;n-N-J>0;){if(!(K>e)){J>n?(N=n-J,B.style.top=N+"px"):(B.style.top="0px",N=0);break}t=P[e-1].index+1,x(t),e++}else N>0&&(N=0,T=0,B.style.top="0px");console.log(X++),W.set(-N/(V-n)),0!=T&&requestAnimationFrame(u)}function c(e){T+=(V-n)*-e-N,requestAnimationFrame(u)}function a(e){var n=e.wheelDeltaY||e.wheelDelta||-e.detail;e.preventDefault(),H||(e.stopPropagation(),w(),T+=n,requestAnimationFrame(u))}function s(e){var n=e.wheelDeltaY||e.wheelDelta||-e.detail;e.preventDefault(),H||(e.stopPropagation(),w(),T+=-n,console.log(n),requestAnimationFrame(u))}function d(){"object"==typeof document.onmousewheel?document.body.addEventListener("mousewheel",a):document.addEventListener("DOMMouseScroll",s)}function f(){"object"==typeof document.onmousewheel?document.body.removeEventListener("mousewheel",a):document.removeEventListener("DOMMouseScroll",s)}function h(e){H||(W.enable(),e.preventDefault())}function m(e){W.disable(),e.preventDefault()}function v(e){var n=!1;if(!H){switch(e.keyCode){case C:p(R),n=!0;break;case E:p(F),n=!0;break;case M:case k:-1!=Q&&(o.onSelectRow(P[Q].index,P[Q].element),n=!0)}n&&(e.preventDefault(),e.stopPropagation())}}function p(e){var n,t;-1==Q?(Q=g(),o.onFocusRow(P[Q].index,P[Q].element)):(n=Q+e,n>=0&&K>n&&(e==F&&n>Y&&(t=P[Y].index+1,x(n)),o.onBlurRow(P[Q].index,P[Q].element),b(n),o.onFocusRow(P[n].index,P[n].element),Q=n))}function w(){-1!=Q&&(o.onBlurRow(P[Q].index,P[Q].element),Q=-1)}function g(){for(var e=-N,n=0,t=0;P.length>t&&!(n>=e);t++)n+=P[t].height;return t}function b(e){for(var t=0,o=0,i=0;P.length>i&&(o=P[i].height,i!=e);i++)t+=o;-N>t?(T+=-(N+t),requestAnimationFrame(u)):o+t>n-N&&(T-=t+o-n+N,requestAnimationFrame(u))}function x(e){var n,o=t.contentForRowAtIndex(e);B.appendChild(o),n=$(o).outerHeight(!0),J+=n,P.push({index:e,element:o,height:n}),l(e,o),Y=e,U=(U*e+n)/(e+1),V=U*K}function D(){for(var e=0;n>J&&K>e;)x(e),e++;V>n&&W.show()}function y(){for(w();B.firstChild;)B.removeChild(B.firstChild);W.hide(),B.style.top="0px",P=[],z=0,Y=-1,J=0,N=0,K=t?t.numberOfRows():0}var R=-1,F=1,C=38,E=40,M=13,k=32,A=this,L="vlv"+Math.round(1e6*Math.random()),S='<div id="<%= id %>" class="vlv-container" style="width:<%=width %>px;height:<%=height %>px;"></div>',q=$(_.template(S,{id:L,width:e,height:n})),I=q[0],O=null,j=$('<div class="vlv-content"></div>'),B=j[0],H=!1,P=[],z=0,Y=-1,J=0,N=0,T=0,G=!1,K=t?t.numberOfRows():0,Q=-1,U=0,V=0,W=null,X=0;return o=o||{},o.onSelectRow=o.onSelectRow||function(){},o.onFocusRow=o.onFocusRow||function(){},o.onBlurRow=o.onBlurRow||function(){},scrollInfoDelegate={},scrollInfoDelegate.scrollHeight=function(){return 5e3},scrollInfoDelegate.clientHeight=function(){return 300},A.getElement=function(){return I},A.show=function(e){I.appendChild(B),W=new jsvlvscrollbar(c),I.appendChild(W.getElement()),q.bind("mouseenter",h),q.bind("mouseleave",m),d(),document.addEventListener("keydown",v,!0),e.appendChild(I),G=!0,O=e,y(),D()},A.hide=function(){q.unbind("mouseenter",h),q.unbind("mouseleave",m),f(),document.removeEventListener("keydown",v,!0),G&&(O&&O.removeChild(I),G=!1)},A.reload=function(){y(),D()},A.freeze=function(){H=!0,W.disable()},A.unfreeze=function(){H=!1,W.enable()},A.dbgdmp=function(){var e={scrollDistance:N,scrollDistancePending:T,contentHeight:J,firstIndex:z,lastIndex:Y,indexOfFocused:Q,contentTop:B.style.top};console.log(JSON.stringify(e))},A}