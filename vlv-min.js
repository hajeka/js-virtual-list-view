function jsvlv(e,n,t,o){function i(e,n){M||o.onSelectRow(e,n)}function r(e,n){n.addEventListener("click",function(){i(e,n)},!1)}function d(){var e;2>Math.abs(z)?(P+=z,z=0):(e=Math.round(.6*z),P+=e,z-=e)}function c(){var e,t;if(d(),q.style.top=P+"px",0>P)for(e=B+1;n-P-I>0;){if(!(j>e)){P=n-I,q.style.top=P+"px";break}t=O[e-1].index+1,v(t),e++}else P>0&&(q.style.top="0px",P=0);0!=z&&requestAnimationFrame(c)}function l(e){e.preventDefault(),M||(e.stopPropagation(),s(),z+=e.wheelDeltaY,requestAnimationFrame(c))}function u(e){var n=!1;if(!M){switch(e.keyCode){case x:a(w),n=!0;break;case R:a(g),n=!0;break;case y:case F:-1!=J&&(o.onSelectRow(O[J].index,O[J].element),n=!0)}n&&(e.preventDefault(),e.stopPropagation())}}function a(e){var n,t;-1==J?(J=f(),o.onFocusRow(O[J].index,O[J].element)):(n=J+e,n>0&&j>n&&(e==g&&n>B&&(t=O[B].index+1,v(n)),o.onBlurRow(O[J].index,O[J].element),h(n),o.onFocusRow(O[n].index,O[n].element),J=n)),b.dbgdmp()}function s(){-1!=J&&(o.onBlurRow(O[J].index,O[J].element),J=-1)}function f(){for(var e=-P,n=0,t=0;O.length>t&&!(n>=e);t++)n+=O[t].height;return t}function h(e){for(var t=0,o=0,i=0;O.length>i&&(o=O[i].height,i!=e);i++)t+=o;-P>t?(z+=-(P+t),requestAnimationFrame(c)):o+t>n-P&&(z-=t+o-n+P,requestAnimationFrame(c))}function v(e){var n,o=t.contentForRowAtIndex(e);q.appendChild(o),n=$(o).outerHeight(!0),I+=n,O.push({index:e,element:o,height:n}),r(e,o),B=e}function m(){for(var e=0;n>I&&j>e;)v(e),e++}function p(){for(s();q.firstChild;)q.removeChild(q.firstChild);q.style.top="0px",O=[],S=0,B=-1,I=0,P=0,j=t?t.numberOfRows():0}var w=-1,g=1,x=38,R=40,y=13,F=32,b=this,C="vlv"+Math.round(1e6*Math.random()),k='<div id="<%= id %>" class="vlv-container" style="width:<%=width %>px;height:<%=height %>px;"></div>',E=$(_.template(k,{id:C,width:e,height:n})),A=E[0],D=null,L=$('<div class="vlv-content"></div>'),q=L[0],M=!1,O=[],S=0,B=-1,I=0,P=0,z=0,H=!1,j=t?t.numberOfRows():0,J=-1;return o=o||{},o.onSelectRow||function(){},o.onFocusRow||function(){},o.onBlurRow||function(){},b.getElement=function(){return A},b.show=function(e){A.appendChild(q),A.addEventListener("mousewheel",l,!0),document.addEventListener("keydown",u,!0),e.appendChild(A),H=!0,D=e,p(),m()},b.hide=function(){A.removeEventListener("mousewheel",l,!0),document.removeEventListener("keydown",u,!0),H&&(D&&D.removeChild(A),H=!1)},b.reload=function(){p(),m()},b.freeze=function(){M=!0},b.unfreeze=function(){M=!1},b.dbgdmp=function(){var e={scrollDistance:P,scrollDistancePending:z,contentHeight:I,firstIndex:S,lastIndex:B,indexOfFocused:J,contentTop:q.style.top};console.log(JSON.stringify(e))},b}